---
description: Построение OLAP-куба в Loginom. Руководство по многомерному анализу данных с помощью визуализатора OLAP куба. Настройка измерений и фактов.
---
# ![Визуализатор Куб](./../../images/icons/common/view_types/cube_default.svg) Куб

[Куб](https://wiki.loginom.ru/articles/cube.html) является одним из распространенных методов комплексного многомерного анализа данных, получивших название [OLAP](https://wiki.loginom.ru/articles/online-analytical-processing.html) (OnLine Analytical Processing). В его основе лежит представление данных в виде многомерных кубов, называемых также OLAP-кубами или гиперкубами.

Куб — это удобное средство визуализации многомерных данных и получения необходимых форм отчетов. Он содержит измерения и факты, определенные при построении. К основной особенности куба относится то, что его структура не является жестко определенной. Манипулируя с помощью мыши заголовками измерений, пользователь может добиться наиболее информативного представления куба.

## Интерфейс

После добавления в узел визуализатора откроется главное окно (Рис. 1):

![Главное окно Куба](./cube-main-window.png)

Главное окно условно можно разделить на 6 областей:

1. Область свободных полей;
2. Область измерений в строках;
3. Область фактов;
4. Область измерений в колонках;
5. Область фильтрации по измерениям;
6. [Панель инструментов Куба](./toolbar.md).

Области со 2 по 5 представляют собой Область построения Куба.

> **Важно:** во время настройки Куба, особенно при работе с большими объемами данных, обновление Области фактов (3) может занимать продолжительное время. В таких случаях рекомендуется временно отключать обновление данных кнопкой ![ ](./../../images/icons/common/toolbar-controls/locked_default.svg) *Приостановить автовычисление*.

### Настройка куба

Список столбцов, которые можно использовать в качестве измерений или фактов, отображается в Области свободных полей (1). Уже используемые в Кубе столбцы отображаются жирным шрифтом.

#### Измерения

Для построения отчета с помощью Куба нужно добавить требуемые измерения в строки или колонки. Добавить измерения в Куб можно несколькими способами:

* Перетащить (Drag-and-Drop) поле из Области свободных полей (1) в Область измерений колонок или строк (2 или 4).
* Нажать кнопку ![Добавить](./../../images/icons/common/toolbar-controls/plus-native_default.svg) нужной области и выбрать необходимое поле из списка.
* Нажать кнопку ![Настроить измерения](./../../images/icons/common/toolbar-controls/dimension_default.svg) на Панели инструментов и распределить поля в нужные области.

Количество измерений ограничено количеством доступных полей. Рекомендуется использовать не более 5-7 измерений, чтобы отчет был понятным и интерпретируемым.

> **Примечание:** при перемещении полей в различные области могут появляться модальные окна подтверждения действия, если измерение или факт используются в активном вычисляемом факте или в фильтре по факту.

Так как визуализатор Куб представляет собой плоскую двухмерную таблицу, то при отображении нескольких измерений заголовки образуют иерархическую систему (дерево заголовков). По умолчанию все заголовки свернуты до самого внешнего измерения. Для раскрытия или сворачивания заголовков внутренних измерений нужно кликнуть по кнопке Развернуть или Свернуть на заголовке внешнего измерения. Существуют групповые операции раскрытия или сворачивания заголовков.

При нажатии на ![Раскрыть меню](./../../images/icons/common/toolbar-controls/down_default.svg) справа от названия измерения доступен выбор:  

* ![Свернуть](../../images/icons/common/toolbar-controls/collapce-all_default.svg) **Свернуть**  все элементы до минимальной детализации измерения;
* ![Развернуть](../../images/icons/common/toolbar-controls/open-all_default.svg) **Развернуть** все элементы до максимальной детализации измерения;
* ![По возрастанию](../../images/icons/common/toolbar-controls/low-to-hight_default.svg) **По возрастанию** — отсортировать значения в порядке возрастания;
* ![По убыванию](../../images/icons/common/toolbar-controls/hight-to-low_default.svg) **По убыванию** — отсортировать значения в порядке убывания;
* ![В исходном порядке](../../images/icons/blank.svg) **В исходном порядке** — выстроить значения в порядке их появления в данных;
* ![Удалить](../../images/icons/common/toolbar-controls/delete_default.svg) **Удалить** — исключить измерение из Куба. Удалить измерение также можно перетаскиванием (Drag-and-Drop) назад в Область свободных полей (1).  

При нажатии на измерение появляется toolbar со следующими возможностями:  
* ![](../../images/icons/common/toolbar-controls/toolbar-controls_18x18_visible_default.svg)**Отметить все** / ![](../../images/icons/common/toolbar-controls/invert-eye_default.svg)**Снять все** — выделяет все значения в списке или снимает выделение со всех значений списка (%kbd Ctrl A %/ %kbd Ctrl Shift A %).
* ![ ](../../images/icons/common/toolbar-controls/invert-eye_default.svg) **Инвертировать выбор** — меняет выбранные значения списка на невыбранные и наоборот.
* ![ ](../../images/icons/common/toolbar-controls/eye-filter_default.svg) **Отметить по маске...** — позволяет задать условие и метод отбора измерений.  
* ![](../../images/icons/common/toolbar-controls/toolbar-controls_18x18_copy_default.svg) **Копировать отмеченные** (%kbd Ctrl C %).
* ![](../../images/icons/common/toolbar-controls/toolbar-controls_18x18_paste_default.svg) **Добавить к отмеченным** (%kbd Ctrl V %).

Специальные возможности копирования и добавления:

* Из фильтра копируются отмеченные значения списка в буфер обмена. 
* В фильтр добавляются значения из буфера обмена и присоединяются к уже существующим значениям.

%spoiler% Ограничения копирования и вставки %spoiler%
  
В браузерах Google Chrome и Mozila Firefox при работе через протокол `http` кнопки ![](../../images/icons/common/toolbar-controls/toolbar-controls_18x18_copy_default.svg) **Копировать**, ![](../../images/icons/common/toolbar-controls/toolbar-controls_18x18_paste_default.svg) **Вставить** и горячая клавиша (%kbd Ctrl C % работать не будут.  

> Примечание: В браузере `Firefox` для расширения функционала по протоколу `https` необходимо в адресной строке браузера ввести `about:config`, найти параметр `dom.events.testing.asyncClipboard` и изменить его значение на `true`. Заработают горячие клавиши и кнопка ![](../../images/icons/common/toolbar-controls/toolbar-controls_18x18_copy_default.svg) Копировать.  

Формат данных буфера обмена — строковые значения, разделенные переводами строки.

%/spoiler%

* **Режим выбора значений фильтра:**  

Чтобы отфильтровать данные по измерению, необходимо щёлкнуть мышью по нужному измерению, произвести настройку фильтра в открывшейся панели и нажать "Применить". Если по измерению настроена фильтрация, то оно выделяется оранжевым цветом. Фильтр может работать в трех режимах:

%spoiler% Фильтр по измерению  %spoiler%

* ![ ](../../images/icons/common/toolbar-controls/icon-200_default.svg) **Множественный выбор** — пользователь может выбрать произвольное количество значений измерения из списка доступных. Выбранные значения будут отображаться в Кубе.
* ![ ](../../images/icons/common/toolbar-controls/icon-201_default.svg)
**Одиночный выбор** — позволяет выбрать из списка только одно значение, которое будет отображаться в Кубе.
* ![ ](../../images/icons/common/toolbar-controls/icon-202_default.svg) **Комбинированный выбор** — позволяет выбрать одно значение измерения из списка, сформированного ранее в режиме множественного выбора.  

В режимах ![ ](../../images/icons/common/toolbar-controls/icon-201_default.svg)
**Одиночный выбор** или ![ ](../../images/icons/common/toolbar-controls/icon-202_default.svg) **Комбинированный выбор** при просмотре куба появляются кнопки у измерения![<](../../images/icons/common/toolbar-controls/arrow-l_default.svg) и ![>](../../images/icons/common/toolbar-controls/arrow-r_default.svg) для перелистывания значений фильтра. При перелистывании Область фактов (3) будет перестраиваться под значение фильтра. Можно включить перелистывание через границы списка значений, нажав на кнопку ![ ](../../images/icons/common/toolbar-controls/roll-over_default.svg) **Зациклить значения при перелистывании**.  

В режиме ![ ](../../images/icons/common/toolbar-controls/icon-200_default.svg) **Множественный выбор** с помощью переключателя **Режим включенных/исключенных** фильтр запоминает проходящие фильтр значения, в режиме исключённых значений фильтр запоминает отфильтрованные значения. При изменении входных данных новые значения будут проходить или не проходить фильтр в зависимости от этой настройки.  


Для настройки отбора открывается окно *Отметить по маске* (в заголовке окна также указано измерение, для которого выполняется настройка). Слева в выпадающем списке необходимо выбрать условие соответствия значений измерения маске. Справа от списка в поле ввода задается маска. Ко всем измерениям, которые соответствуют условию, будет применен выбранный метод отбора (*Отметить, Добавить к отмеченным, Снять* или *Удалить из отмеченных*). При отборе может учитываться регистр букв, для этого нужно установить флаг *Учитывать регистр*.  

| Режим                   | Копирование        | Вставка        |
|:-:|:-:|:-:|
|Множественный, режим включенных значений             |Копируются все включенные значения (проходящие фильтр) | Успешно распознанные значения добавляются во включенные значения |
| Множественный, режим исключенных значений     |Копируются все исключенные значения (непроходящие фильтр)            |Успешно распознанные значения добавляются в исключенные значения|
| Одиночный и комбинированный режимы | Копируется текущее выбранное значение            | Обрабатывается только первое строковое значение, остальные игнорируются, успешно распознанное значение становится выделенным, на него прокручивается таблица  |

%/spoiler%

> **Примечание:** над Областью измерений (4) Куба находится Область фильтрации (5). Настройка Области фильтрации аналогична настройке Области измерений. Измерения, добавленные в Область фильтрации, не будут отображаться в Кубе, но могут быть использованы в вычисляемых фактах и для фильтрации данных.

#### Факты

Добавить факты можно двумя способами:

* Перетащить (Drag-and-Drop) нужное поле из Области свободных полей (1) в Область фактов (3);
* Нажать кнопку ![Факты](./../../images/icons/common/toolbar-controls/sum_default.svg) Факты, выбрать необходимое поле и в появившемся [окне](./add-measure.md) выбрать нужный вариант [агрегации](./../../processors/func/aggregation-functions.md) и способ его отображения.  

%spoiler%Агрегация фактов и возможные типы данных%spoiler%

|Вид агрегации|![](./../../images/icons/common/data-types/string_default.svg)|![](./../../images/icons/common/data-types/integer_default.svg)|![](./../../images/icons/common/data-types/float_default.svg)|![](./../../images/icons/common/data-types/boolean_default.svg)|![](./../../images/icons/common/data-types/datetime_default.svg)|![](./../../images/icons/common/data-types/variant_default.svg)|
|:-|:-:|:-:|:-:|:-:|:-:|:-:|
|![](./../../images/icons/common/aggregations/factor-sum_default.svg) Сумма||**•**|**•**||||
|![](./../../images/icons/common/aggregations/factor-count_default.svg) Количество|**•**|**•**|**•**|**•**|**•**|**•**|
|![](./../../images/icons/common/aggregations/factor-min_default.svg) Минимум|**•**|**•**|**•**|**•**|**•**||
|![](./../../images/icons/common/aggregations/factor-max_default.svg) Максимум|**•**|**•**|**•**|**•**|**•**||
|![](./../../images/icons/common/aggregations/factor-avg_default.svg) Среднее||**•**|**•**||**•**||
|![](./../../images/icons/common/aggregations/factor-stddev_default.svg) Стандартное отклонение||**•**|**•**||**•**||
|![](./../../images/icons/common/aggregations/factor-unique-count_default.svg) Количество уникальных|**•**|**•**|**•**|**•**|**•**|**•**|
|![](./../../images/icons/common/aggregations/factor-null-count_default.svg) Количество пропусков|**•**|**•**|**•**|**•**|**•**|**•**|
|![](./../../images/icons/common/aggregations/factor-stat-first_default.svg) Первый|**•**|**•**|**•**|**•**|**•**|**•**|
|![](./../../images/icons/common/aggregations/factor-stat-last_default.svg) Последний|&nbsp;&nbsp;**•**&nbsp;&nbsp;|&nbsp;&nbsp;**•**&nbsp;&nbsp;|&nbsp;&nbsp;**•**&nbsp;&nbsp;|&nbsp;&nbsp;**•**&nbsp;&nbsp;|&nbsp;&nbsp;**•**&nbsp;&nbsp;|&nbsp;&nbsp;**•**&nbsp;&nbsp;|

%/spoiler%

Нажав на кнопку ![Раскрыть список](./../../images/icons/common/toolbar-controls/down_default.svg) рядом с ![Факты](./../../images/icons/common/toolbar-controls/sum_default.svg) Факты, можно открыть выпадающее меню с вызовом одного из окон:

* ![Настроить факты](./../../images/icons/viewers/cube/cases/case-tune_default.svg) **Настроить факты…** — открыть окно настройки фактов;
* ![Добавить вычисляемый факт](./../../images/icons/viewers/cube/cases/case-calc_default.svg) **Добавить вычисляемый факт…** — открыть окно для добавления вычисляемого факта в Куб;
* ![Фильтровать факты](./../../images/icons/viewers/cube/cases/case-filter_default.svg) **Фильтровать факты…** — открыть окно для фильтрации фактов;
* ![Форматировать факты](./../../images/icons/viewers/cube/cases/case-format_default.svg) **Форматировать факты…** — открыть окно для форматирования фактов и заголовков измерений.

Удалить факт можно снятием флага в вызываемом окне *Настроить факты*.

>**Примечание:** по умолчанию в качестве варианта агрегации и способа его отображения выбирается идущий первым по списку. Поддерживается отображение сразу нескольких вариантов агрегации и способов их отображения для каждого факта.

Кнопку ![Факты](./../../images/icons/common/toolbar-controls/sum_default.svg)Факты можно перемещать из строк в столбцы и таким образом менять положение заголовков фактов. В случаях когда требуется переместить факт в измерения, необходимо с помощью метода DnD переместить факты из Область измерений в колонках переместить (4) в Область измерений в строках (2).