# ![Вычисляемый факт](../../images/icons/cube/cases/case-calc_default.svg) Вычисляемый факт

Позволяет добавить свой факт в куб. Вычисляется на основе используемых в Кубе и области фильтрации измерений и фактов.

Необходимо задать:

* **Имя** — идентификатор, который можно использовать в формулах других вычисляемых фактов;
* **Метка** — строка, под которой факт будет виден в кубе и диаграмме;
* **Тип данных** — тип данных вычисляемого выражения;
* **Метка агрегации** — значок для вычисляемого выражения.

Окно настройки вычисляемого факта представлено на Рис.1 и условно разделено на 3 области.

![Окно настройки вычисляемого факта](./cube-calculating-fact.png)

## 1. Область ввода выражения

В области ввода задается формула расчета выражения. Ссылки на измерения, факты и синтаксические конструкции функций можно вставлять в код выражения, выбрав их двойным кликом мыши в соответствующих областях, либо написав вручную.

The expression formula can contain the following components:

* ссылки на используемые измерения и факты куба в виде наименования измерений и фактов;
* варианты агрегации измерений и фактов;
* brackets defining the order of operations execution;
* characters of mathematical operations and relations;
* логические операции (AND, OR, NOT, XOR) и значения (TRUE или FALSE);
* функции в соответствии с синтаксическим описанием ([Список функций](#spisok-funktsiy));
* string expressions in quotation marks ("string expression");
* integer and real numbers;
* single-line and multi-line comments.

The single-line comment starts from `//` (two slashes) characters, and it continues until the end of the string. The multi-line comment is represented by all characters included between `/*` (slash-asterisk) and `*/` (asterisk-slash).

> **Важно:** если выражение вычисляемого факта некорректное, то все его ячейки состоят из пропусков. Также в выражении недопустимо применять рекурсивные обращения к фактам.

## 2. Список измерений и фактов

Область содержит список измерений и фактов, которые можно использовать в вычисляемых фактах.

Двойной клик мыши по позиции дерева измерений и фактов вводит имя измерения или факта с выбранной функцией агрегации в область ввода выражения. То же самое можно сделать, написав имя измерения или факта в область ввода вручную.

Новый факт создается на основе существующих фактов и измерений при помощи ряда функций и производных переменных от значений измерений:

* **Значение** (*Имя измерения.Value*) — значение измерения. Можно опустить имя функции измерения, в таком случае по умолчанию будет функция Value, т.е. *Имя измерения* = *Имя измерения.Value*.
* **Количество** (*Имя измерения.Count*) — количество уникальных значений измерения.
* **Итог** (*Имя измерения.IsTotal*) — проверка, является ли значение измерения итогом. Переменная используется совместно с функциями *IF()/IFF()*, для модификации значений вычисляемого факта в итоговых ячейках.
* **Пусто** (*Имя измерения.IsNull*) — проверка, является ли значение измерения пропущенным значением.

и от способов агрегации фактов:

* **Сумма** (*Имя факта.Sum* ) — сумма всех значений фактов.
* **Количество** (*Имя факта.Count* ) — количество всех значений фактов.
* **Среднее** (*Имя факта.Avg* ) — среднее из всех значений фактов.
* **Минимум** (*Имя факта.Min* ) — наименьшее из всех значений фактов.
* **Максимум** (*Имя факта.Max* ) — наибольшее из всех значений фактов.
* **Стандартное откл.** (*Имя факта.StdDev* ) — стандартное отклонение значений фактов.
* **Сумма квадратов** (*Имя факта.SumSq* ) — сумма квадратов всех значений фактов.
* **Кол-во уникальных** (*Имя факта.UniqueCount* ) — количество уникальных значений факта.
* **Кол-во пропусков** (*Имя факта.NullCount* ) — количество пропущенных значений факта.
* **Первый** (*Имя факта.First* ) — первое по списку значение факта.
* **Последний** (*Имя факта.Last* ) — последнее по списку значение факта.

Внутри каждого из способов агрегации имеется доступ к итоговым значениям по каждому измерению **Итог** (*Имя факта.Sum.Total.Имя измерения*).

> **Примечание:** в списке будут доступны только используемые факты и измерения. Измерения, которые не были перенесены в строки, столбцы или область фильтрации, в списке доступны не будут.

## 3. List of Functions

Область содержит наименование, входные аргументы и описание [доступных для использования функций](../../processors/func/calc-func/README.md).

It is possible to filter by the function category and name.

Double click on the position of the selected function enables to enter its syntax to the expression code area. То же самое можно сделать, перетащив функцию из списка в область кода (Drag-and-Drop).
