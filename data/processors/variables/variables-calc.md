# ![Калькулятор-переменные](../../images/icons/components/calc-variables_default.svg) Калькулятор (переменные)

Обработчик предназначен для математических операций над переменными. В мастере настройки создаются новые переменные и вычисляются их значения в соответствии с выражениями, заданными пользователем.

> **Важно:** Расчет значений выражений осуществляется в том порядке, в котором они следуют в списке выражений, т.е. сначала вычисляются выражения, находящиеся выше в списке. В формуле выражения возможно использовать только выражения, находящиеся выше по списку. В связи с этим неверная позиция в списке может приводить к ошибке.

## Ports

### Input

* ![Входные переменные](../../images/icons/app/node/ports/inputs-optional/variable_inactive.svg) **Входные переменные** — список переменных, которые можно использовать в обработчике.

### Output

* ![Выходные переменные](../../images/icons/app/node/ports/outputs/variable_inactive.svg) **Выходные переменные** — входные переменные и новые переменные, вычисленные обработчиком.

## Wizard

Окно настроек содержит области:

1. [Список выражений](#spisok-vyrazheniy);
2. [Область кода выражения](#oblast-koda-vyrazheniya);
3. [Переменные](#peremennye);
4. [Список функций](#spisok-funktsiy).

### Список выражений

Область предназначена для ввода *выражений* — вычисляемых переменных, которыми в результате обработки будет дополнен выходной набор данных. Значение выражения в каждой строке набора данных будет вычислено по формуле, заданной в области кода выражения.

Новое выражение можно создать при помощи панели инструментов области или контекстного меню. Операции панели инструментов и контекстного меню:

* ![Редактировать](../../images/icons/toolbar-controls/edit_default.svg) **Редактировать** — задание параметров выражения;
* ![Переместить вверх](../../images/icons/toolbar-controls/up_default.svg) **Переместить вверх** — поднять выражение на одну позицию вверх по списку;
* ![Переместить вниз](../../images/icons/toolbar-controls/down_default.svg) **Переместить вниз** — опустить выражение на одну позицию вниз по списку;
* ![Добавить выражение](../../images/icons/toolbar-controls/plus_default.svg) **Добавить выражение** — добавляет новое выражение с параметрами по умолчанию;
* ![Добавить выражение по образцу](../../images/icons/toolbar-controls/clone_default.svg) **Добавить выражение по образцу** — добавляет новое выражение с типом данных, описанием и формулой, как у текущего выражения;
* ![Удалить выражение](../../images/icons/toolbar-controls/delete_default.svg) **Удалить выражение** — удаляет текущее выражение;
* ![Удалить все выражения](../../images/icons/toolbar-controls/delete-all_default.svg) **Удалить все выражения…** — удаляет все имеющиеся выражения.

При добавлении и редактировании выражения отображается диалог редактирования параметров. Следующие параметры выражений доступны для изменений:

* **Имя** — имя переменной в выходном наборе данных;
* **Метка** — метка переменной в выходном наборе данных;
* **Тип** — [тип данных](../../data/datatype.md) переменной в выходном наборе данных;
* **Промежуточное** — при установке этого флага выражение может использоваться в расчетах, но не включается в список переменных выходного набора данных;
* **Описание** — поясняющая информация.

> **Важно:** Имя должно быть уникальным, начинаться с заглавной или строчной латинской буквы или с символа подчеркивания. Последующие символы имени могут быть такими же, либо цифрами.

При первом открытии мастера настройки список выражений содержит один элемент с именем *Expr0* вещественного типа. По умолчанию для нового выражения назначается метка *ВыражениеN* и имя *ExprN*, где *N* — номер, обеспечивающий уникальность.

После настройки параметров выражения в область кода требуется ввести рассчитываемую формулу.

### Область кода выражения

В области кода задается формула расчета выражения. Ссылки на переменные и синтаксические конструкции функций можно вставлять в код выражения, выбрав их двойным кликом мыши в соответствующих областях или перетащив мышкой.

Изменения в области кода сохраняются при выходе из нее.

Формула выражения может содержать:

* ссылки на другие переменные набора данных в виде наименования переменных или ранее вычисленных выражений;
* ссылки на переменные входного порта;
* скобки, определяющие порядок выполнения операций;
* знаки математических операций и отношений;
* логические операции (AND, OR, NOT, XOR) и значения (TRUE или 1, FALSE или 0);
* функции в соответствии с синтаксическим описанием (см. далее [Список функций](#spisok-funktsiy));
* строковые выражения в кавычках, например, `"строковое выражение"`;
* целые и вещественные числа;
* однострочные и многострочные комментарии.

> **Важно:** вещественные числа записываются с использованием десятичной точки, например, *`2.71`*.

#### Панель быстрого доступа

На панели расположены кнопки, по нажатию на которые в область кода выражения вставляется заготовка либо шаблон.

Логические операции:

* **AND** — операция Логическое "И";
* **OR** — операция Логическое "ИЛИ";
* **NOT** — операция Логическое "НЕ";
* **XOR** — операция Логическое "исключающее ИЛИ".

Операторы сравнения:

* **=** — Равно;
* **<>** — Не равно;
* **<** — Меньше;
* **>** — Больше;
* **<=** — Меньше или равно;
* **>=** — Больше или равно.

Шаблоны:

* ![Вещественное число](../../images/icons/toolbar-controls/type-float_default.svg) — для ввода вещественного числа, будет вставлено `0.0`;
* ![Строка](../../images/icons/toolbar-controls/type-string_default.svg) — для ввода строки, будет вставлено `""`;
* ![Дата](../../images/icons/toolbar-controls/type-date_default.svg) — для ввода даты, будет вставлено `StrToDate("____-__-__", "YYYY-MM-DD")`;
* ![Время](../../images/icons/toolbar-controls/type-time_default.svg) — для ввода времени, будет вставлено `StrToDate("__:__:__", "HH:NN:SS")`.

Логические значения:

* **FALSE** — Ложь;
* **TRUE** — Истина.

#### Комментарии

Однострочный комментарий начинается символами `//` (два слеша) и продолжается до конца строки. Многострочным комментарием считаются все символы, содержащиеся между `/*` (слеш-звездочка) и `*/` (звездочка-слеш).

Пример комментария:

```java
// Пример однострочного комментария.

IF(IsNull(var_one),var_two,var_one) // однострочный комментарий продолжается до конца строки

/* Многострочным комментарием
считаются все символы,
содержащиеся между (слеш-звездочка)
 и (звездочка-слеш). */
```

### Переменные

Область содержит список переменных, передаваемых на вход обработчика. Перечень и параметры переменных определяются при настройке входных портов обработчика.

Двойной клик мыши по позиции списка вводит имя переменной в область кода выражения.

### Список функций

Наименование, входные аргументы и описание [доступных для использования функций](../func/calc-func/README.md).

Возможна фильтрация по категории и названию функции.

Двойной клик мыши по позиции выбранной функции вставляет ее синтаксис в область кода выражения. То же самое можно сделать при помощи Drag-and-Drop.

---

> **Примечание**: Обработчик "Калькулятор" использует механизм [ленивых вычислений](https://wiki.loginom.ru/articles/lazy-evaluation.html), это означает, что расчет производится только тогда, когда значение выражения отображается или используется другим узлом сценария.
