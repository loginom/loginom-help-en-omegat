# ![Замена](../../../images/icons/components/replace-columns_default.svg) Замена

Обработчик заменяет данные исходного набора, используя таблицы замен. The replacement tables contain couples of the replaced and new values or regular expressions that enable to compute them. Эти таблицы можно задать вручную в мастере настройки (внутренние) или подать на вход обработчика (внешние).

Sequence of the replacement algorithm actions:

1. Вначале производится поиск и замена по [точному совпадению](./exact-match.md) со значениями, указанными в таблице замен;
2. The search among the values not found by exact match is performed by [regular expressions](./regexp-match.md). Такие выражения могут быть заданы во внутренних таблицах замен. Новые значения также вычисляются регулярными выражениями;
3. Replacement rules are observed for the values not found at the previous steps.

### Input

* ![Входной источник данных](../../../images/icons/app/node/ports/inputs/table_inactive.svg) **Входной источник данных** (таблица данных) — набор данных, подлежащий изменению;
* ![Набор данных](../../../images/icons/app/node/ports/inputs/table_inactive.svg) **Присоединяемая таблица [N]** (таблица данных) — набор данных, содержащий таблицу замен;
* ![Добавление порта](../../../images/icons/app/node/ports/add/add_inactive_default.svg) **Добавление еще одного порта.** Поскольку таблиц замен может быть несколько, то необходимые порты для них могут быть добавлены пользователем.

### Output

* ![Выходной набор данных](../../../images/icons/app/node/ports/inputs/table_inactive.svg) **Выходной набор данных** (таблица данных). При настройке соответствия между столбцами порта можно выбрать варианты замены или добавления столбцов.

## Wizard

Окно мастера настройки состоит из 3-х областей:

1. [Способы замен](#sposoby-zamen);
2. [Таблица замен](#tablitsa-zamen);
3. [Дополнительные параметры](#dopolnitelnye-parametry).

### Способы замен

Для каждого поля исходного набора задается способ замены:

* **Не заменять** — выходной набор данных замены производиться не будут;
* **Ввод вручную** — используется внутренняя таблица замен;
* **Таблица замен** (Таблица замен N) — используется внешняя таблица замен. Данный способ присутствует в настройках, если на входной порт обработчика подаются данные внешней таблицы замен.

**Таблица замен N** — наименование принимающего таблицу порта.

### Replacement Table

Отображает внешнюю или внутреннюю таблицу замен для выбранного поля исходного набора.

#### Настройка внутренней таблицы

Для ввода новой строки в таблице замены используется кнопка ![Добавление строки](../../../images/icons/toolbar-controls/plus_default.svg). The table can contain strings for search and replacement according to the following requirements:

* [Точному совпадению](./exact-match.md);
* [Регулярному выражению](./regexp-match.md) (применимо только к данным строкового типа).

> **Важно:** в случае замены числовых данных стоит учитывать интервалы, в которые попадет то или иное заменяемое значение.

%spoiler%Example%spoiler%

Пусть имеется следующая таблица:

| Value |
|:--------:|
| 5 |
| 10 |
| 15 |

Правила замены вида: 1) `5 => -5`; 2) `15 => -15`.

И точность равная `5`.

В этом случае выходная таблица будет иметь вид:

| Value |
|:--------:|
| -5 |
| -15 |
| -15 |

То есть получились два полуинтервала вида [5, 10) и [10, 15).
Соответственно, граничные значения входят в тот интервал, где они являются начальными.

%/spoiler%

При вводе вручную таблицы замены доступны ряд действий через панель инструментов области:

* ![Импорт](../../../images/icons/toolbar-controls/import_default.svg) **Импорт** — импорт таблицы замен из текстового файла определенной [структуры](./import-tz.md);
* ![Экспорт](../../../images/icons/toolbar-controls/export_default.svg) **Экспорт** — экспорт таблицы замен в текстовый файл;
* ![Сортировка](../../../images/icons/toolbar-controls/sort-asc_default.svg) **Сортировка** — сортировка таблицы по полю исходного значения;
* **Изменить тип замены** — задает тип данных столбца с новыми значениями;
* ![Редактировать текущую замену](../../../images/icons/toolbar-controls/edit_default.svg) **Редактировать текущую замену** — отображает область редактирования текущей строки таблицы подстановок;
* ![Получить значения](../../../images/icons/toolbar-controls/load-values_default.svg) **Получить значения** — подгружает выпадающий список, вызываемый кнопкой ![ ](../../../images/icons/toolbar-controls/down_default.svg), в поле *Значение*, при ручном вводе таблицы замен.

> **Примечание:** Замена по точному совпадению имеет приоритет перед заменой по регулярному выражению.

#### Настройка внешней таблицы

Для полей таблицы необходимо выбрать **Назначение** из следующих вариантов:

* ![Не используется](../../../images/icons/usage-types/unspecified_default.svg) **Не используемое** — поле таблицы замен не будет использоваться;
* ![Значение](../../../images/icons/usage-types/source_default.svg) **Значение** — поле содержит заменяемые значения;
* ![Замена](../../../images/icons/usage-types/replace-by_default.svg) **Замена** — поле содержит новые значения;
* ![Информационное](../../../images/icons/usage-types/unspecified_default.svg) **Информационное** — поле содержит дополнительный вариант нового значения. Дополнительные варианты замены выводятся в результирующем наборе данных отдельным столбцом.

> **Примечание:** Если замена одного значения может быть произведена по условиям нескольких строк таблицы замен, то приоритет имеет первая из них. В связи с этим **сортировка таблицы замен может влиять на результат обработки**. Данное правило не применяется при использовании [допустимого интервала](./exact-match.md#primenenie-dopustimogo-intervala) (см. параметр *Точность*).

### Additional Parameters

* **Заменять остальные** — содержит варианты замены значений, не найденных при помощи таблицы замен.
   * **Не заменять** — замены производиться не будут.
   * **На пропущенное** — значения будут заменены на Null.
   * **На значение** — значения будут заменены на указанное.
   * **На регулярное выражение** — новое значение будет вычислено с использованием синтаксиса [регулярного выражения](./regexp-match.md).
* **Точность** — для полей целого и вещественного типов задает [допустимый интервал](./exact-match.md#primenenie-dopustimogo-intervala) от указанных в таблицах замен значений, при котором исходное значение будет заменено.
* **Case-sensitive strings**: the flag installs the case-sensitive mode of values search in the replacement tables. По умолчанию данный режим не используется.
