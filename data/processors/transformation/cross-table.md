# ![Кросс-таблица](../../images/icons/components/cross-tab_default.svg) Кросс-таблица

Обработчик создает сводную таблицу на основе исходного набора. При создании таблицы:

* Часть полей исходного набора остается без изменений, образуя **строки** сводной таблицы;
* Значения ячеек другой группы полей образуют **колонки** сводной таблицы, задавая их заголовки;
* Данные третьей группы полей участвуют в расчете **фактов** — [агрегированных значений](../func/aggregation-functions.md) на пересечении строк и колонок сводной таблицы.

%spoiler%Пример:%spoiler%

Исходная таблица:

| Дата | Товар | Количество продаж |
| :------- | :------- | -------: |
| 05.02.2017 | Обои | 2000 |
| 05.02.2017 | Затирка | 300 |
| 07.02.2017 | Обои | 2000 |
| 07.02.2017 | Герметик | 750 |
| 07.02.2017 | Грунтовка | 400 |
| 10.02.2017 | Грунтовка | 400 |
| 10.02.2017 | Обои | 3000 |
| 11.02.2017 | Герметик | 250 |

Преобразуем исходную таблицу со следующими параметрами: колонки - *Товар*, строки - *Дата*, факты - *Количество продаж*. По полю *Количество продаж* выберем функцию агрегации *Сумма*.

Выходной набор данных:

| Дата | Герметик | Грунтовка | Затирка | Обои |
| :------- | -------: | -------: | -------: | -------: |
| 05.02.2017 | 750 | | 300 | 4000 |
| 07.02.2017 | 250 | 800 | | 3000 |

После обработки значения поля *Товар* перешли в заголовки новых столбцов, значения поля *Дата* остались в строках, а значения поля *Количество продаж* просуммированы по датам.

%/spoiler%

### Вход

* ![Входной источник данных](../../images/icons/app/node/ports/inputs/table_inactive.svg) **Входной источник данных** — порт для подключения входного набора данных.

### Выход

* ![Выходной источник данных](../../images/icons/app/node/ports/inputs/table_inactive.svg) **Выходной набор данных** — на порт выводится таблица с обработанными данными.

## Wizard

Окно мастера поделено на две области: доступные поля (слева) и выбранные поля (справа).

* **Доступные поля** — содержит поля входного набора данных.
* **Выбранные поля** — делится на группы.
   * ![Колонки](../../images/icons/dataset-operations/dsa-columns_default.svg) Колонки.
   * ![Строки](../../images/icons/dataset-operations/dsa-rows_default.svg) Строки.
   * ![Факты](../../images/icons/dataset-operations/dsa-factor_default.svg) Факты.

В области *Доступные поля* помимо полей входного набора данных всегда присутствует синтетическое поле *Количество*, оно может быть добавлено только в группу *Факты*. В нем будет подсчитано, сколько раз в исходном наборе данных встречается каждая комбинация из колонок и строк.

### Колонки

Значения этих полей станут заголовками столбцов. Поля в данной группе обязательно должны иметь дискретный [вид данных](../../data/datakind.md)

При работе с кросс-таблицей может возникнуть ситуация, когда в полях, по которым были сформированы колонки, появляются новые значения. В обработчике имеется два подхода к решению этой проблемы:

* **Скользящие уникальные значения** — заново создает колонки из уникальных значений поля (полей). При изменении значений исходного набора данных вся структура результирующей таблицы полностью перестроится с учетом новых уникальных значений. Также можно установить минимальное число значений поля, из которых будут созданы колонки. Но в этом случае в результирующей таблице сохранится столбец с оставшимися значениями.

%spoiler%Пример:%spoiler%

Входная таблица:

| Точка продажи | Товар | Сумма продажи |
|:--------------|:-----:|:--------------|
| СтройРынок | Обои | 170 |
| СтройРынок | Плитка | 400 |

Кросс-таблица с колонкой: Товар<br>
Для колонки установлено минимальное количество уникальных значений = 4<br>
Со строкой: Точка продажи<br>
Фактом: Сумма продажи (Сумма).<br>

Результирующая таблица

| Точка продажи | Обои | Плитка | 3 | 4 |
|:--------------|:-----:|:-----:|---|---|
| СтройРынок | 170 | 400 | | |

Если во входной набор добавился ещё 1 товар

| Точка продажи | Товар | Сумма продажи |
|:--------------|:-----:|:--------------|
| СтройРынок | Обои | 170 |
| СтройРынок | Плитка | 400 |
| СтройРынок | Герметик | 135 |

И настройки кросс-таблицы не изменились, то результирующий набор будет следующим

| Точка продажи | Обои | Плитка | Герметик | 4 |
|:--------------|:-----:|:-----:|:--------:|---|
| СтройРынок | 170 | 400 | 135 | |

%/spoiler%

* **Группа значений** — если в исходном поле с момента последней настройки узла появятся новые значения, то при включенном флаге *Прочие* факты для таких значений будут агрегироваться в столбце *Прочие*. Установленный флаг *Пропущенные* обеспечивает  отображение в выходном наборе данных полей с пропущенными значениями. Факты для них будут агрегироваться в столбце *Пропущенные значения*.

В нижней части мастера расположена область *Общие настройки для колонок* имеющая следующие параметры:

* **Разделитель частей меток полей** — выбирается каким символом будут разделены метки новых полей, при выборе нескольких полей в колонках.
   * . (точка).
   * | (горизонтальная линия).
   * ->.
   * Пробел.
* **Скользящие уникальные значения** — установка флага позволяет заново создавать колонки из уникальных значений поля (полей). При изменении значений исходного набора данных вся структура результирующей таблицы полностью перестроится с учетом новых значений.
* **Ограничение количества значений** — используется, чтобы ограничить максимальное количество колонок  в выходном наборе, отбираются первые n сформированных полей, если установленное количество значений больше  количества уникальных значений в колонках, то фиктивные столбцы не добавляются.

С помощью кнопок ![Вверх](../../images/icons/toolbar-controls/moveup_default.svg) и ![Вниз](../../images/icons/toolbar-controls/movedown_default.svg) можно менять порядок полей в группе. То, в каком порядке расположены поля, влияет на структуру результирующей таблицы.

%spoiler%Пример:%spoiler%

Исходная таблица:

|Точка продажи|Товар|Сумма продажи|Дата|
|:-|:-|-:|:-|
|СтройРынок|Обои|170|10.04.2012|
|СтройРынок|Плитка|400|10.04.2012|
|СтройРынок|Герметик|135|10.04.2012|
|Павильон|Обои|240|11.04.2012|
|Павильон|Плитка|80|11.04.2012|
|Павильон|Герметик|40|12.04.2012|
|СтройРынок|Обои|130|12.04.2012|
|Павильон|Обои|130|12.04.2012|
|Павильон|Плитка|20|12.04.2012|
|Павильон|Обои|230|13.04.2012|
|СтройРынок|Герметик|65|13.04.2012|
|Павильон|Герметик|260|13.04.2012|

*Кросс-таблица* с порядком колонок: *Товар*, *Точка продажи*.  Фактом: *Сумма продажи (Сумма)*. И параметром *Разделитель частей меток полей*: `.`

|Герметик.Павильон|Герметик.СтройРынок|Обои.Павильон|Обои.СтройРынок|Плитка.Павильон|Плитка.СтройРынок|
|-:|-:|-:|-:|-:|-:|
|300|200|600|300|100|400|

*Кросс-таблица* с порядком колонок: *Точка продажи*, *Товар*. Фактом: *Сумма продажи (Сумма)*. И параметром *Разделитель частей меток полей*: `.`

|Павильон.Герметик|Павильон.Обои|Павильон.Плитка|СтройРынок.Герметик|СтройРынок.Обои|СтройРынок.Плитка|
|-:|-:|-:|-:|-:|-:|
|300|600|100|200|300|400|

%/spoiler%

### Строки

Из значений полей  сформируются строки в кросс-таблице. Одинаковые значения поля (полей) будут сгруппированы таким же образом, как это происходит в обработчике [Группировка](../../processors/transformation/grouping.md).

Порядок полей в данной группе влияет на порядок сортировки данных в результирующей таблице по этим полям.

%spoiler%Пример:%spoiler%

Исходная таблица:

|Точка продажи|Товар|Сумма продажи|Дата|
|:-|:-|-:|:-|
|СтройРынок|Обои|170|10.04.2012|
|СтройРынок|Плитка|400|10.04.2012|
|СтройРынок|Герметик|135|10.04.2012|
|Павильон|Обои|240|11.04.2012|
|Павильон|Плитка|80|11.04.2012|
|Павильон|Герметик|40|12.04.2012|
|СтройРынок|Обои|130|12.04.2012|
|Павильон|Обои|130|12.04.2012|
|Павильон|Плитка|20|12.04.2012|
|Павильон|Обои|230|13.04.2012|
|СтройРынок|Герметик|65|13.04.2012|
|Павильон|Герметик|260|13.04.2012|

*Кросс-таблица* с порядком строк: *Точка продажи*, *Дата*. Фактом: *Сумма продажи (Сумма)*.

|Точка продажи|Дата|Сумма продажи|
|:-|:-|-:|
|Павильон|11.04.2012|320|
|Павильон|12.04.2012|190|
|Павильон|13.04.2012|490|
|СтройРынок|10.04.2012|705|
|СтройРынок|12.04.2012|130|
|СтройРынок|13.04.2012|65|

%/spoiler%

### Факты

Данные полей в этой группе обрабатываются в соответствии с [функциями агрегации](../func/aggregation-functions.md). Получившиеся значения отображаются на пересечении колонок и строк. По умолчанию для числовых типов выбрана функция *Сумма*, а для всех остальных *Количество*.

Чтобы выбрать другие функции агрегации, необходимо дважды кликнуть по полю. При выборе нескольких вариантов функций, каждая из них будет рассчитана в отдельном столбце.

В группе *Факты* порядок полей не имеет значения.
