# ![ ](../../../images/icons/components/calc-data_default.svg) Калькулятор

Создает новые поля, которые вычисляются по заданной формуле из значений переменных, других полей и [функций](../../func/calc-func/README.md) или используя [JavaScript](./javascript.md) код.

### Вход

* ![ ](../../../images/icons/app/node/ports/outputs/table_inactive.svg) Входной источник данных (таблица данных);
* ![ ](../../../images/icons/app/node/ports/inputs-optional/variable_inactive.svg) Входные переменные (переменные), необязательный.

### Выход

* ![ ](../../../images/icons/app/node/ports/outputs/table_inactive.svg) Выходной набор данных (таблица данных).

## Wizard

Окно настроек содержит области:

1. [Список выражений](#spisok-vyrazheniy);
2. [Область кода выражений](#oblast-koda-vyrazheniya);
3. [Поля/переменные](#polyaperemennye);
4. [Список функций](#spisok-funktsiy).

### Список выражений

Область предназначена для ввода *Выражений* — вычисляемых полей, которыми в результате обработки будет дополнен входной набор данных. Значение выражения в каждой строке набора данных будет вычислено по [формуле](./expression.md) или JavaScript коду.

Новое выражение можно создать при помощи панели инструментов области или контекстного меню. Операции панели инструментов и контекстного меню:

* ![ ](../../../images/icons/calcdata/expression_default.svg)|![](../../../images/icons/calcdata/javascript_default.svg) **Синтаксис** (выпадающий список)— задание [синтаксиса расчета выражений](#sintaksis-kalkulyatora) калькулятора;
* ![ ](../../../images/icons/toolbar-controls/edit_default.svg) **Редактировать** — задание параметров выражения;
* ![ ](../../../images/icons/toolbar-controls/up_default.svg) **Переместить вверх** — поднять выражение на одну позицию вверх по списку;
* ![ ](../../../images/icons/toolbar-controls/down_default.svg) **Переместить вниз** — опустить выражение на одну позицию вниз по списку;
* ![ ](../../../images/icons/toolbar-controls/plus_default.svg) **Добавить выражение** — добавляет новое выражение с параметрами по умолчанию;
* ![ ](../../../images/icons/toolbar-controls/clone_default.svg) **Добавить выражение по образцу** — добавляет новое выражение с типом данных, описанием и формулой, как у текущего выражения;
* ![ ](../../../images/icons/toolbar-controls/delete_default.svg) **Удалить выражение** — удаляет текущее выражение;
* ![ ](../../../images/icons/toolbar-controls/delete-all_default.svg) **Удалить все выражения** — удаляет все имеющиеся выражения.

При добавлении и редактировании выражения отображается диалог редактирования параметров. Следующие параметры выражений доступны для изменений:

* **Имя** — вводится [имя поля](../../../data/datasetfieldoptions.md) присваемое столбцу в выходном наборе данных;
* **Метка** — вводится [метка поля](../../../data/datasetfieldoptions.md) присваемая столбцу в выходном наборе данных;
* **Тип данных** — выбирается [тип данных](../../../data/datatype.md) поля в выходном наборе данных;
* **Промежуточное** — при установке этого флага выражение может использоваться в расчетах, не включается в список полей выходного набора данных;
* **Кэшировать** — сохранение однажды вычисленного значения выражения, целесообразно при неоднократном использовании значений выражения последующими обработчиками и визуализаторами во избежание выполнения повторных вычислений;
* **Описание** — поясняющая информация.

> **Важно:** Имя должно быть уникальным, начинаться с заглавной или строчной латинской буквы или с символа подчеркивания. Последующие символы имени могут быть такими же, либо цифрами.

При первом открытии мастера настройки список выражений содержит один элемент с именем `Expr0` вещественного типа. По умолчанию для нового выражения назначается метка `ВыражениеN` и имя `ExprN`, где `N` — номер, обеспечивающий уникальность.

### Область кода выражения

В области кода в зависимости от выбранного синтаксиса калькулятора задается [формула расчета выражения](./expression.md) или [JavaScript код](./javascript.md). Ссылки на входящие поля/переменные и синтаксические конструкции функций можно вставлять в код выражения, выбрав их двойным кликом мыши в соответствующих областях или перетащив мышкой. Ссылки на созданные в *Калькуляторе* выражения задаются в области кода ручным вводом имени выражения.

Изменения в области кода сохраняются при выходе из нее.

### Поля/переменные

Область содержит список полей и переменных, передаваемых на вход обработчика. Перечень и параметры полей/переменных определяются при настройке входных портов обработчика.

Двойной клик мыши по позиции списка вводит имя поля/переменной в область кода выражения. То же самое можно сделать при помощи Drag-and-drop.

### Список функций

Наименование, входные аргументы и описание [доступных для использования функций](../../func/calc-func/README.md).

Возможна фильтрация по категории и названию функции.

Двойной клик мыши по позиции выбранной функции вставляет ее синтаксис в область кода выражения. То же самое можно сделать при помощи Drag-and-drop.

Ссылки на поля/переменные и синтаксические конструкции функций можно вставлять в код выражения, выбрав их двойным кликом мыши в соответствующих областях или перетащив мышкой.

## Синтаксис калькулятора

В калькуляторе существует два способа расчета выражений:

* ![ ](../../../images/icons/calcdata/expression_default.svg) [Выражение](./expression.md);
* ![ ](../../../images/icons/calcdata/javascript_default.svg) [JavaScript](./javascript.md).

Для выбора синтаксиса необходимо в меню списка выражений выбрать *JavaScript* или *Выражение* (см. Figure 1).

![Выбор режима работы калькулятора](./readme-1.png)

> **Примечание:** Режим работы калькулятора *Выражение* или *JavaScript* выбирается для всех полей, т.е. нельзя установить для одного поля синтаксис *Выражение*, а для другого *JavaScript*.
